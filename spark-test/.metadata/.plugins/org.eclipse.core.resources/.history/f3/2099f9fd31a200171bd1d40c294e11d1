package KPI

import org.apache.spark._
import org.apache.spark.SparkContext._
import org.apache.log4j._
import java.util.ArrayList
import org.apache.spark.rdd.RDD

object NivelIngresos {
  
  
  /**
   * Data Array del TablÃ³n
   * 17 => RUC
   * 6 => CODESTABLECIMIENTO
   * 14 => CODCLAVECIC_CLIENTE
   * 25 => CODMES
   * 46 => RANGO_SUELDO
   * 47 => TIPUSODIGITAL
   * 48 => DESTIPUSODIGITAL 
   */
  
  def NivelIngresos(ruta: String,esta: List[String], inicio: String, fin: String) = {
    val sc = new SparkContext("local[*]", "NivelIngresos")
    val rdd = sc.textFile(ruta)
    val r1 = rdd.map(r => r.split("\t")).map(r => (r(6), r(25), r(46)))
    
    var rddFiltrado = r1.filter(x => (x._2 >= inicio && x._2 <= fin) && esta.exists(p => p.contains(x._1)))
    
    println("Detalle")
    rddFiltrado.foreach(println)
    println("Total")
    println(rddFiltrado.count())
    
    println("Res final")
    rddFiltrado.map(x => (x._3, 1)).reduceByKey(_ + _).foreach(println)
    
  }

  def main(args: Array[String]) {

    NivelIngresos("tablon.tsv",List("100070934","100070905"),"201511","201512")


  }
  
}